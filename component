import streamlit as st
from services.api.auth import authenticate_user
from services.utils.validator import validate_email

def show_login():
    st.title("Connexion")
    
    with st.form("login_form"):
        email = st.text_input("Email", key="login_email")
        password = st.text_input("Mot de passe", type="password", key="login_password")
        submit_button = st.form_submit_button("Se connecter")
        
        if submit_button:
            if not validate_email(email):
                st.error("Email invalide")
            elif len(password) < 6:
                st.error("Le mot de passe doit contenir au moins 6 caractères")
            else:
                response = authenticate_user(email, password)
                if response.get('success'):
                    st.session_state.authenticated = True
                    st.session_state.user = response['user']
                    st.rerun()
                else:
                    st.error(response.get('message', "Échec de la connexion"))
    
    if st.button("Mot de passe oublié ?"):
        st.session_state.show_password_reset = True
